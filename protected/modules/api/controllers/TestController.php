<?php

class TestController extends CController
{
    public function actionIndex()
    {
        //$api = 'zrnzd5rs8i';
        //$secret = 'YzyrQiHRGDZhsh7ENiRi6YdE5';
        $api = 'ekhabkh4a8';
        $secret = '7tDEKZDyDB4Yybnyh3N773b2B';

        $params = array(
            'ApiKey' => $api,
            'Hash' => md5($api . $secret),
            'Query' => '454, 21002, 321, 41919, 19072, 117222, 86129, 16493, 201051, 131475, 273731, 111968, 169154, 28176, 314162, 191227, 13523, 51589, 8894, 162687, 106375, 284965, 200403, 85144, 136857, 86237, 17825, 53680, 7451, 319506, 2619, 60444, 320669, 648, 17991, 320375, 141927, 103561, 101951, 136952, 28304, 124546, 9971, 1568, 126015, 314055, 34484, 14865, 53744, 51080, 1487, 18028, 117950, 116200, 202061, 37865, 125189, 114995, 322277, 33695, 165208, 194643, 247487, 11183, 17798, 38939, 315296, 14203, 1201, 123804, 231748, 37024, 13100, 88424, 1827, 366233, 357643, 469, 246053, 16297, 104365, 34768, 108449, 143484, 86941, 29892, 42567, 375306, 43843, 301889, 29663, 20996, 731, 13457, 924, 1807, 142257, 97523, 98808, 15466, 83585, 169717, 14996, 198934, 1445, 108866, 54453, 158844, 144561, 158470, 320334, 192798, 81563, 86947, 324075, 118320, 330138, 239134, 82748, 201151, 109065, 11678, 108697, 165410, 31033, 30050, 55504, 107893, 244936, 373053, 54697, 164497, 90744, 169709, 129368, 200195, 53502, 54339, 16456, 13717, 240834, 173259, 421914, 85070, 16535, 141745, 52799, 141989, 198231, 202326, 124815, 80952, 131240, 125073, 16253, 2290, 14250, 102968, 16890, 54629, 328215, 303744, 131513, 17415, 172157, 19647, 29084, 129283, 105749, 96674, 123221, 83504, 16901, 29157, 82767, 118085, 240713, 415164, 41149, 197127, 107283, 203250, 421716, 132349, 14161, 121234, 355051, 143919, 79279, 356019, 34922, 172998, 171011, 295022, 197085, 192637, 393256, 34130, 418994, 55244, 117557, 14822, 11750, 13769, 97485, 36536, 245559, 393201, 327615, 45848, 127909, 14647, 16909, 90923, 41477, 868, 285006, 138469, 39432, 210886, 314208, 86757, 361766, 298189, 13918, 167735, 88067, 2508, 129390, 245105, 3925, 247306, 129574, 330263, 144002, 318224, 119382, 117117, 404251, 34249, 17261, 41420, 185690, 328461, 16182, 98929, 419936, 142461, 250482, 123398, 122155, 33708, 11298, 419941, 198446, 315549, 122120, 14222, 319283, 29188, 50204, 168096, 109255, 1320, 320749, 41011, 147695, 14607, 320638, 515, 271430, 16717, 144911, 298893, 51117, 163267, 130187, 144017, 29937, 17125, 319319, 34359, 54026, 14493, 320319, 116867, 80944, 56172, 24980, 198248, 416734, 297490, 393255, 13425, 116721, 116509, 123125, 169015, 82617, 382, 404406, 1005, 137474, 36621, 349799, 315312, 13581, 53382, 23864, 109847, 50006, 11683, 98467, 55357, 30219, 117940, 172244, 166402, 16533, 22669, 274292, 129484, 207321, 298721, 295276, 132973, 95906, 95553, 423435, 14605, 172966, 13586, 321810, 150394, 418520, 29984, 37244, 14739, 53953, 164492, 245858, 153952, 99414, 5635, 55819, 82896, 130650, 862, 12131, 200468, 13748, 18557, 418464, 107701, 152259, 30076, 171461, 168519, 49766, 81560, 142384, 39474, 51077, 163962, 44517, 200101, 43448, 318581, 413084, 91645, 322169, 33402, 148738, 39948, 29913, 108712, 82511, 56083, 922, 19380, 197794, 13272, 45692, 171710, 83474, 96866, 13441, 128735, 118930, 17580, 117066, 1264, 17445, 129235, 44934, 118818, 356860, 144082, 91171, 10009, 118001, 293800, 29927, 144692, 154981, 314754, 106794, 40074, 108757, 3616, 356996, 169874, 16384, 35940, 13094, 105000, 84089, 194157, 402252, 118967, 12236, 128853, 185853, 97722, 205298, 142308, 33636, 56075, 53643, 29334, 246603, 14108, 207267, 148897, 30321, 417512, 84018, 9890, 10334, 144336, 13568, 36231, 123169, 417840, 27097, 144903, 149573, 116684, 575, 117706, 19106, 14335, 28317, 149234, 115264, 18866, 255032, 147761, 402512, 96571, 51388, 181800, 44314, 13418, 115462, 147057, 147653, 107766, 130057, 2782, 18155, 14908, 19736, 139292, 49453, 44330, 14132, 107013, 143165, 147103, 9027, 83203, 168588, 52720, 312238, 15309, 314733, 114040, 150038, 208709, 273813, 51160, 1449, 136789, 86283, 55511, 116876, 29766, 49456, 54315, 264050, 118964, 84498, 102336, 32128, 936, 32530, 97844, 16846, 33409, 1042, 232919, 166566, 6878, 34609, 14361, 19606, 35352, 12998, 40974, 88556, 13222, 200349, 1023, 109460, 87659, 30707, 1555, 54344, 127964, 45455, 107087, 38029, 1106, 10752, 93847, 29776, 357521, 84052, 118627, 92418, 34989, 17107, 85065, 43349, 12827, 56519, 4893, 207291, 191281, 194565, 15154, 184261, 200870, 30589, 15743, 85153, 93824, 136660, 378934, 95549, 97871, 46269, 298524, 14246, 82860, 235584, 79499, 91810, 125020, 366241, 98936, 13809, 275987, 207675, 91168, 29661, 357172, 343, 22637, 193544, 113098, 15787, 269239, 129493, 38740, 357698, 36834, 149097, 113528, 832, 129564, 4694, 95411, 13438, 42775, 170775, 355142, 83481, 84324, 44057, 97532, 202523, 118040, 16284, 11569, 188869, 906, 115370, 28613, 40421, 242001, 95163, 125766, 96428, 91354, 14639, 37752, 41514, 13681, 4866, 86741, 199791, 21147, 15661, 510, 96517, 84431, 357924, 16838, 117934, 21896, 168203, 115151, 5481, 33812, 51726, 50999, 1886, 31150, 164534, 16479, 97747, 14585, 12806, 278289, 273437, 355461, 106206, 28202, 40139, 20601, 349354, 163235, 196982, 14510, 53440, 94022, 11277, 144642, 36610, 315051, 31606, 230863, 318129, 16464, 14643, 98236, 96940, 19236, 13176, 253199, 320818, 81856, 320734, 199878, 169047, 366102, 16139, 15362, 50090, 31609, 33128, 210652, 911, 355453, 14072, 299042, 320324, 13252, 92136, 331566, 81308, 409183, 98031, 105013, 54550, 15984, 200608, 18043, 11216, 87541, 31113, 91368, 198555, 107052, 201019, 150073, 196540, 1660, 324193, 162273, 275715, 16766, 1683, 356951, 32994, 345, 29611, 124473, 11062, 50947, 267814, 13613, 14012, 317794, 339242, 318338, 81803, 35478, 82805, 37786, 89400, 107169, 152673, 323362, 153082, 20501, 17719, 355561, 17833, 240488, 29711, 52785, 148541, 663, 30926, 166169, 319239, 14704, 355145, 30701, 329679, 30015, 28794, 376394, 366195, 34085, 51267, 4884, 119239, 205459, 54481, 4403, 40156, 256843, 179191, 28403, 102897, 19486, 51910, 197972, 416531, 266320, 112984',
        );

        //$params['Email'] = 'alaris.nik@gmail.com';
        //$params['LastName'] = 'Никитин';
        //$params['FirstName'] = 'Виталий';
        //$params['ExternalId'] = 121;
        //$params['RoleId'] = 5;

        //$params['OnlyPublic'] = true;
        //$params['WithDeleted'] = 1;

        //$params['SectionId'] = 12322;
        //$this->apiRequest('/api/section/deleteFavorite', $params);
        exit;
        print_r($params);
        $this->apiRequest('/api/user/search', $params);
    }

    private function apiRequest($url, $params)
    {
        $curl = curl_init();
        curl_setopt($curl, CURLOPT_TIMEOUT, 60);
        curl_setopt($curl, CURLOPT_CONNECTTIMEOUT, 10);
        curl_setopt($curl, CURLOPT_FOLLOWLOCATION, 1);
        curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);

        $url = $this->createAbsoluteUrl($url, $params);

        echo $url;

        curl_setopt($curl, CURLOPT_URL, $url);


        $result = curl_exec($curl);

        echo '<pre>';
        print_r($result);

        echo  curl_error ($curl);
        $result = json_decode($result);

        print_r($result);
        echo '</pre>';
    }
}
